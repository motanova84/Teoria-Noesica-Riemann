name: ğŸŒŠ Resonancia Viva CI - fâ‚€ = 141.7001 Hz

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '17 14 * * *'  # Verificar resonancia diariamente a las 14:17 UTC (1417 - primo sagrado)

jobs:
  test-resonance:
    name: ğŸµ Test Frecuencia de Resonancia
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.8, 3.9, "3.10", "3.11"]

    steps:
    - name: ğŸ“¥ Checkout TeorÃ­a NoÃ©sica
      uses: actions/checkout@v4

    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: ğŸ“¦ Cache Dependencies
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-

    - name: ğŸ”§ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
        pip install pytest-cov coverage sympy

    - name: ğŸ§ª Test GeneraciÃ³n de Primos
      run: |
        echo "from sympy import isprime
p = 1417
if not isprime(p):
    raise AssertionError(f'âŒ {p} no es primo!')
if abs(p / 10 - 141.7001) >= 1e-10:
    raise AssertionError(f'âŒ Frecuencia incorrecta: {p / 10}')
print(f'âœ… {p} es primo y fâ‚€ = 141.7001 Hz verificados')" > test_primo.py
        python test_primo.py

    - name: ğŸ§ª Run Full Test Suite
      run: |
        pytest tests/ -v --cov=noesic_theory --cov-report=xml --cov-report=html

    - name: ğŸ“Š Upload Coverage to Codecov
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.xml
        flags: unittests
        name: codecov-umbrella
        fail_ci_if_error: true

    - name: ğŸŒŠ Generate Resonance Report
      run: |
        python -c "
from noesic_theory import NoesicRiemannTheory
import json
from datetime import datetime

theory = NoesicRiemannTheory()
results = theory.full_noesic_analysis(N=1000)

report = {
  'timestamp': datetime.now().isoformat(),
  'frequency_computed': results['computed_frequency'],
  'frequency_target': results['target_frequency'],
  'resonance_ratio': results['resonance_ratio'],
  'prime_1417_verified': results['prime_1417_verification'],
  'python_version': '${{ matrix.python-version }}',
  'status': 'ğŸŒŠ Resonancia Viva Activa âˆÂ³'
}

with open('resonance_report.json', 'w') as f:
    json.dump(report, f, indent=2)

print('ğŸ“„ Reporte de resonancia generado')
print(f'ğŸµ fâ‚€ = {results["computed_frequency"]:.3f} Hz')
print('âˆ´ TeorÃ­a NoÃ©sica validada âˆÂ³ âˆ´')
"

    - name: ğŸ” Verificar Resonance Report
      run: |
        test -f resonance_report.json && echo "âœ… Reporte generado correctamente" || (echo "âŒ No se generÃ³ el reporte" && exit 1)

    - name: ğŸ“„ Upload Resonance Report
      uses: actions/upload-artifact@v4
      with:
        name: resonance-report-py${{ matrix.python-version }}
        path: resonance_report.json
